
<html lang="en">
<head>
	<link rel="stylesheet" href="style.css">
	
	<script type="text/javascript" src="./gl-matrix.js"></script>
	<script type="text/javascript" src="./menu.js"></script>
	<script type="text/javascript" src="./foo.js"></script>
    
	<script id="shader-fs" type="x-shader/x-fragment">
		precision mediump float;
		varying vec3 color;
		varying vec3 normal;
		varying vec4 pos;

		const vec3 light_pos = vec3(10,5,-10);

		void main(void) {
			vec3 light_dir = normalize(light_pos - pos.xyz/pos.w);
			vec3 n = normalize(normal);
			vec3 v = normalize(light_pos - pos.xyz/pos.w);

			vec3 r = 2.*dot(light_dir, n)*n - light_dir;




			vec3 amb = 0.1 * color;
			vec3 dif = max(0.,dot(light_dir, n)) * color;
			vec3 spe = 1. * pow(max(0.,dot(v, r)), 30.) * vec3(1,1,1);

			dif=max(dif,vec3(0));
			spe=max(spe,vec3(0));


			gl_FragColor = vec4(amb+dif+spe,1);
		}
	</script>

<script id="shader-vs" type="x-shader/x-vertex">
precision mediump float;
  attribute vec3 aVertexPosition;
  attribute vec3 aVertexColor;
  attribute vec3 aVertexPosition2;
  attribute vec3 aVertexPosition3;
  attribute vec3 aVertexLevels;

  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;
  uniform float spike;
  uniform float spikeparam1;
  uniform float spikeparam2;
  uniform int colormode;
  varying vec3 color;
  varying vec3 normal;
  varying vec4 pos;
  

  void main(void) {

	vec3 levels = vec3(1,1,1) + pow(4., 2.-spikeparam1*2.)* 0.025*(0.3+spike) * pow(aVertexLevels, vec3(spikeparam1*2.+1.));
  

  	if (colormode==0)
    		color=aVertexColor;
	else
	{
		float color_level;
		if (colormode==1) color_level = aVertexLevels.x;
		if (colormode==2) color_level = min(min(aVertexLevels.x, aVertexLevels.y), aVertexLevels.z);
		if (colormode==3) color_level = (aVertexLevels.x + aVertexLevels.y + aVertexLevels.z) / 3. -1. ;
		if (color_level < 1.)
			color = vec3(1,0,0);
		else if (color_level < 2.)
			color = vec3(0,1,0);
		else if (color_level < 3.)
			color = vec3(0,0,1);
		else if (color_level < 4.)
			color = vec3(0,1,1);
		else if (color_level < 5.)
			color = vec3(1,1,0);
		else
			color = vec3(1,0,1);
	}
	
	
	pos = uMVMatrix * vec4(levels.x*aVertexPosition, 1);
	vec4 pos2= uMVMatrix * vec4(levels.y*aVertexPosition2, 1);
	vec4 pos3= uMVMatrix * vec4(levels.z*aVertexPosition3, 1);

	vec3 mid = (pos + pos2 + pos3).xyz / 3.;
    //normal=normalize(mat3(uMVMatrix)*aVertexNormal);
    normal = normalize(  normalize( cross( vec3(pos-pos2), vec3(pos-pos3) ) )   +   2.*(-0.5+spikeparam2)* normalize(pos.xyz-mid) );
    
    //gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
    gl_Position = uPMatrix * pos;
  }
</script>
</head>



<body onload="start()" onscroll="alert('foo')">
<canvas id="glcanvas">
</canvas>
<div id="menu">
	<div class="menu_item">
		<label for="rendertype_radio">Rendertype: </label>
		<form id="rendertype_radio">
			<input type="radio" id="r0" name="rendertype" value="0" onclick="igitt(this)" checked="checked"/>
			<label for="r0">0</label>
			<input type="radio" id="r1" name="rendertype" value="1" onclick="igitt(this)" />
			<label for="r1">1</label>
			<input type="radio" id="r2" name="rendertype" value="2" onclick="igitt(this)" />
			<label for="r2">2</label>
			<input type="radio" id="r3" name="rendertype" value="3" onclick="igitt(this)" />
			<label for="r3">3</label>
		</form>	
	</div>
	<div class="menu_entry">
		<label for="x_slider">X: </label>
		<input id="x_slider" type="range" min="0" max="1.0" step="0.05" value="0.75" oninput="handle_slider(this)"/>
	</div>
	<div class="menu_entry">
		<label for="y_slider">Y: </label>
		<input id="y_slider" type="range" min="0" max="1.0" step="0.05" value="0.5" oninput="handle_slider(this)"/>
	</div>
</div>
</body>
